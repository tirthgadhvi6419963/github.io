<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üíò For Aayushi</title>
  <meta name="theme-color" content="#ff3b7a" />
  <style>
    :root{
      --bg1:#ffe6f0;
      --bg2:#fff2cc;
      --card:rgba(255,255,255,.88);
      --text:#151515;
      --muted:rgba(21,21,21,.65);
      --pink:#ff3b7a;
      --shadow:0 18px 52px rgba(0,0,0,.14);
      --radius:26px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:
        radial-gradient(900px 700px at 25% 12%, rgba(255,255,255,.95) 0%, rgba(255,255,255,0) 60%),
        radial-gradient(900px 700px at 75% 0%, rgba(255,255,255,.75) 0%, rgba(255,255,255,0) 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      display:grid;
      place-items:center;
      overflow:hidden;
      padding: 18px;
      color: var(--text);
    }

    /* floating hearts */
    .heart{
      position:absolute;
      width:18px;height:18px;
      transform:rotate(45deg);
      background: rgba(255,255,255,.85);
      animation: floatUp linear infinite;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.10));
      border-radius:4px;
      pointer-events:none;
      opacity:.7;
    }
    .heart:before,.heart:after{
      content:"";
      position:absolute;
      width:18px;height:18px;
      background: inherit;
      border-radius:50%;
    }
    .heart:before{ left:-9px; top:0 }
    .heart:after{ top:-9px; left:0 }
    @keyframes floatUp{
      from{ transform:translateY(45vh) translateX(0) rotate(45deg); opacity:0 }
      10%{opacity:1}
      to{ transform:translateY(-120vh) translateX(80px) rotate(45deg); opacity:0 }
    }

    canvas#fx{
      position:fixed;
      inset:0;
      pointer-events:none;
    }

    .card{
      width:min(760px, 96vw);
      background: var(--card);
      border: 1px solid rgba(255,255,255,.75);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      overflow:hidden;
      position:relative;
    }

    .playground{
      height: 360px;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      padding: 20px;
    }

    .panel{
      padding: 20px 18px 22px;
      text-align:center;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 9px 12px;
      border-radius: 999px;
      background: rgba(255,59,122,.12);
      color: var(--pink);
      font-weight: 900;
      letter-spacing:.2px;
    }

    h1{
      margin: 14px 0 10px;
      font-size: clamp(26px, 5.5vw, 44px);
      line-height: 1.08;
      letter-spacing: -.2px;
    }

    p{
      margin: 0 auto 16px;
      max-width: 60ch;
      color: var(--muted);
      font-size: clamp(14.5px, 3.8vw, 16px);
      line-height: 1.55;
    }

    .btnRow{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top: 10px;
    }

    .mainBtn{
      appearance:none;
      border:none;
      cursor:pointer;
      padding: 14px 18px;
      min-width: 180px;
      border-radius: 16px;
      font-size: 18px;
      font-weight: 950;
      color: #fff;
      background: linear-gradient(135deg, #ff2d55, #ff5aa5);
      box-shadow: 0 16px 32px rgba(255,45,85,0.30);
      transition: transform .12s ease, box-shadow .12s ease;
      position:relative;
      overflow:hidden;
      touch-action: manipulation;
    }
    .mainBtn:hover{ transform: translateY(-1px); box-shadow: 0 20px 40px rgba(255,45,85,0.38); }
    .mainBtn:active{ transform: translateY(1px); box-shadow: 0 12px 26px rgba(255,45,85,0.25); }

    .miniBtn{
      font-size: 13px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,0.92);
      cursor:pointer;
      touch-action: manipulation;
    }

    .bigHeart{
      font-size: 86px;
      filter: drop-shadow(0 18px 26px rgba(0,0,0,.12));
      user-select:none;
      pointer-events:none;
      transition: transform .15s ease;
    }

    .ask{ display:block; }
    .success{ display:none; animation: pop .35s ease both; }
    @keyframes pop{
      from{ transform: scale(.985); opacity:0 }
      to{ transform: scale(1); opacity:1 }
    }

    .tinyNote{
      margin-top: 10px;
      font-size: 12.5px;
      opacity:.55;
    }

    /* Gift options panel (shows after Celebrate) */
    .giftPanel{
      display:none;
      margin-top:14px;
      padding-top:14px;
      border-top:1px dashed rgba(0,0,0,.14);
      text-align:left;
    }
    .giftTitle{
      text-align:center;
      font-weight:850;
      margin: 0 0 10px;
      font-size: 15px;
      opacity:.92;
    }
    .giftGrid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:10px;
      margin-top:10px;
    }
    @media (max-width: 460px){
      .giftGrid{ grid-template-columns: 1fr; }
      .playground{ height: 320px; }
    }
    .giftCard{
      text-align:left;
      border:1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.9);
      border-radius:16px;
      padding:12px 12px;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color:transparent;
      transition: transform .14s ease, box-shadow .2s ease, border-color .15s ease;
      min-height: 78px;
    }
    .giftCard:hover{ transform: translateY(-1px); box-shadow:0 12px 24px rgba(0,0,0,.08); }
    .giftCard.selected{
      border-color: rgba(255,59,122,.55);
      box-shadow: 0 18px 34px rgba(255,59,122,.18);
    }
    .giftEmoji{ font-size:22px; margin-bottom:6px; }
    .giftName{ font-weight:900; }
    .giftSub{ font-size:12.5px; opacity:.65; margin-top:2px; }

    .giftActions{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:12px;
    }
    .statusBox{
      display:none;
      margin-top:10px;
      border:1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.9);
      border-radius:14px;
      padding:10px 12px;
      text-align:center;
      font-weight:850;
    }

    /* toast */
    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform:translateX(-50%);
      background: rgba(0,0,0,0.78);
      color:#fff;
      padding:10px 12px;
      border-radius: 12px;
      font-size: 13px;
      opacity:0;
      transition: opacity .2s ease, transform .2s ease;
      pointer-events:none;
      z-index: 20;
    }
    .toast.show{ opacity:1; transform:translateX(-50%) translateY(-4px); }
  </style>
</head>

<body>
  <canvas id="fx"></canvas>

  <div class="card">
    <div class="playground">
      <div class="bigHeart">üíñ</div>
    </div>

    <div class="panel">
      <!-- ASK -->
      <section class="ask" id="ask">
        <div class="badge">üíå Just for Aayushi</div>
        <h1>Aayushi‚Ä¶ will you be my Valentine? üíò</h1>
        <p>
          I tried to write something ‚Äúcool‚Äù‚Ä¶ but honestly:
          you make my days feel softer and my smiles feel easier.
          So‚Ä¶ one tiny click? üòÑ
        </p>

        <div class="btnRow">
          <button class="mainBtn" id="yesBtn">Yes üíò</button>
          <button class="mainBtn" id="noBtn">No üôÑ</button>
        </div>

        <div class="btnRow" style="margin-top:12px;">
          <button class="miniBtn" id="copyLinkBtn" type="button">Copy shareable link</button>
        </div>

        <div class="tinyNote">P.S. ‚ÄúNo‚Äù is‚Ä¶ suspiciously hard to click üòÖ</div>
      </section>

      <!-- SUCCESS -->
      <section class="success" id="success">
        <div class="badge">‚úÖ Officially adorable</div>
        <h1>YAYYY! It‚Äôs a date üíû</h1>
        <p id="successText">Aayushi, you just made my whole day (and probably the next 365 too).</p>

        <div class="btnRow">
          <button class="mainBtn" id="celebrateBtn">Celebrate üéâ</button>
          <button class="miniBtn" id="backBtn" type="button">Back</button>
        </div>

        <div class="giftPanel" id="giftPanel">
          <div class="giftTitle">Okay Aayushi üòÑ pick what you want:</div>

          <div class="giftGrid" id="giftGrid">
            <div class="giftCard" data-gift="Flowers üíê">
              <div class="giftEmoji">üíê</div>
              <div class="giftName">Flowers</div>
              <div class="giftSub">classic + pretty</div>
            </div>

            <div class="giftCard" data-gift="Chocolate üç´">
              <div class="giftEmoji">üç´</div>
              <div class="giftName">Chocolate</div>
              <div class="giftSub">sweet tooth approved</div>
            </div>

            <div class="giftCard" data-gift="Small teddy üß∏">
              <div class="giftEmoji">üß∏</div>
              <div class="giftName">Small teddy</div>
              <div class="giftSub">tiny + cute</div>
            </div>

            <div class="giftCard" data-gift="Flowers + Ice cream üíêüç¶">
              <div class="giftEmoji">üíêüç¶</div>
              <div class="giftName">Flowers + Ice cream</div>
              <div class="giftSub">best combo</div>
            </div>
          </div>

          <div class="giftActions">
            <button class="miniBtn" id="confirmGiftBtn" type="button">Confirm ‚úÖ</button>
            <button class="miniBtn" id="copyChoiceBtn" type="button" style="display:none;">Copy choice üíå</button>
          </div>

          <div class="statusBox" id="giftStatus"></div>
        </div>
      </section>
    </div>
  </div>

  <div class="toast" id="toast">Copied!</div>

  <script>
    // Hearts bg
    const HEARTS = 18;
    for (let i=0; i<HEARTS; i++){
      const h = document.createElement("div");
      h.className = "heart";
      const left = Math.random()*100;
      const dur = 6 + Math.random()*7;
      const delay = Math.random()*-dur;
      const size = 10 + Math.random()*18;
      h.style.left = left + "vw";
      h.style.animationDuration = dur + "s";
      h.style.animationDelay = delay + "s";
      h.style.width = size + "px";
      h.style.height = size + "px";
      h.style.opacity = (0.35 + Math.random()*0.55).toFixed(2);
      document.body.appendChild(h);
    }

    // Canvas FX
    const canvas = document.getElementById("fx");
    const ctx = canvas.getContext("2d");
    let W, H;
    function resize(){
      W = canvas.width = window.innerWidth;
      H = canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resize);
    resize();

    const confetti = [];
    const bursts = [];

    function confettiBurst(x, y){
      const count = 120;
      for (let i=0; i<count; i++){
        confetti.push({
          x: x + (Math.random()-0.5)*90,
          y: y + (Math.random()-0.5)*40,
          vx: (Math.random()-0.5)*10,
          vy: -Math.random()*10 - 4,
          g: 0.22 + Math.random()*0.18,
          r: 2 + Math.random()*4,
          a: 1,
          spin: (Math.random()-0.5)*0.25
        });
      }
    }

    function emojiBurst(){
      const emojis = ["üíñ","üíò","üíû","‚ú®","üòç","ü•∞","üíù","üå∏"];
      const x = W/2, y = H/2;
      for (let i=0; i<26; i++){
        bursts.push({
          x, y,
          vx: (Math.random()-0.5)*8,
          vy: -Math.random()*7 - 3,
          g: 0.18 + Math.random()*0.12,
          a: 1,
          rot: (Math.random()-0.5)*0.3,
          size: 18 + Math.random()*14,
          char: emojis[Math.floor(Math.random()*emojis.length)]
        });
      }
    }

    function tick(){
      ctx.clearRect(0,0,W,H);

      // confetti
      for (let i=confetti.length-1; i>=0; i--){
        const p = confetti[i];
        p.vy += p.g;
        p.x += p.vx;
        p.y += p.vy;
        p.a *= 0.985;

        if (p.a < 0.02 || p.y > H+50){
          confetti.splice(i,1);
          continue;
        }

        ctx.save();
        ctx.globalAlpha = p.a;
        ctx.translate(p.x, p.y);
        ctx.rotate(p.spin);

        const grd = ctx.createLinearGradient(-6,-6,6,6);
        grd.addColorStop(0, "rgba(255,255,255,0.95)");
        grd.addColorStop(1, "rgba(255,255,255,0.35)");
        ctx.fillStyle = grd;
        ctx.fillRect(-p.r, -p.r, p.r*2, p.r*2);
        ctx.restore();
      }

      // emoji
      for (let i=bursts.length-1; i>=0; i--){
        const b = bursts[i];
        b.vy += b.g;
        b.x += b.vx;
        b.y += b.vy;
        b.a *= 0.982;

        if (b.a < 0.03 || b.y > H+80){
          bursts.splice(i,1);
          continue;
        }

        ctx.save();
        ctx.globalAlpha = b.a;
        ctx.translate(b.x, b.y);
        ctx.rotate(b.rot);
        ctx.font = `${b.size}px system-ui, Apple Color Emoji, Segoe UI Emoji`;
        ctx.fillText(b.char, -b.size/2, b.size/2);
        ctx.restore();
      }

      requestAnimationFrame(tick);
    }
    tick();

    // UI + logic
    const ask = document.getElementById("ask");
    const success = document.getElementById("success");
    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const celebrateBtn = document.getElementById("celebrateBtn");
    const backBtn = document.getElementById("backBtn");
    const bigHeart = document.querySelector(".bigHeart");
    const successText = document.getElementById("successText");

    const params = new URLSearchParams(location.search);
    const toName = "Aayushi";
    const fromName = params.get("from") || "Me";

    // --- Auto-send choice to your email via Formspree ---
    // If you don't want email sending, set this to "".
    const FORM_ENDPOINT = "https://formspree.io/f/xkovjdwn";

    function showToast(msg){
      const toast = document.getElementById("toast");
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(()=>toast.classList.remove("show"), 1200);
    }

    // "No" dodging
    function moveNoBtn(){
      const rect = noBtn.getBoundingClientRect();
      const pad = 12;
      const vw = window.innerWidth;
      const vh = window.innerHeight;

      const newLeft = Math.min(vw - rect.width - pad, Math.max(pad, Math.random() * (vw - rect.width - pad*2)));
      const newTop  = Math.min(vh - rect.height - pad, Math.max(pad, Math.random() * (vh - rect.height - pad*2)));

      noBtn.style.position = "fixed";
      noBtn.style.left = newLeft + "px";
      noBtn.style.top = newTop + "px";
      noBtn.style.zIndex = "10";
    }
    noBtn.addEventListener("mouseenter", moveNoBtn);
    noBtn.addEventListener("touchstart", (e)=>{ e.preventDefault(); moveNoBtn(); }, {passive:false});
    noBtn.addEventListener("click", (e)=>{ e.preventDefault(); moveNoBtn(); });

    // Yes -> success
    yesBtn.addEventListener("click", ()=>{
      ask.style.display = "none";
      success.style.display = "block";
      bigHeart.textContent = "üíñ";
      confettiBurst(W/2, H/2);
      emojiBurst();
    });

    // Celebrate fun
    let celebrated = 0;
    function burst(){
      confettiBurst(W/2, H/2);
      emojiBurst();
    }

    function celebrate(){
      celebrated++;
      showGiftPanel();
      burst();
      bigHeart.style.transform = "scale(1.06)";
      setTimeout(()=>bigHeart.style.transform="scale(1)", 140);

      const lines = [
        `${toName}, you just made ${fromName} smile like an idiot üòÑ`,
        "Okayyy this is officially cute now üíû",
        "You‚Äôre making this way too adorable üòç",
        "More confetti. More love. Yes. üíñ",
        "If happiness had a button‚Ä¶ it‚Äôs this one ü•∞",
        "This is your fault (in the best way) üíù"
      ];
      successText.textContent = lines[celebrated % lines.length];

      const btnTexts = ["Celebrate üéâ","Again! üéä","One more üòÑ","Okay last one üòÖ","Moreee üíñ"];
      celebrateBtn.textContent = btnTexts[celebrated % btnTexts.length];
    }
    celebrateBtn.addEventListener("click", celebrate);

    // Back
    backBtn.addEventListener("click", ()=>{
      success.style.display = "none";
      if (giftPanel) giftPanel.style.display = "none";
      if (giftStatus) giftStatus.style.display = "none";
      if (copyChoiceBtn) copyChoiceBtn.style.display = "none";
      selectedGift = "";
      ask.style.display = "block";
      // reset "No" button positioning
      noBtn.style.position = "";
      noBtn.style.left = "";
      noBtn.style.top = "";
    });

    // Copy shareable link
    document.getElementById("copyLinkBtn").addEventListener("click", async ()=>{
      const base = location.origin + location.pathname;
      const link = base + `?from=${encodeURIComponent(fromName)}`;
      try{
        await navigator.clipboard.writeText(link);
        showToast("Link copied üíå");
      }catch(e){
        showToast("Copy from address bar");
      }
    });

    // --- Gift choices (appear after Celebrate) ---
    const giftPanel = document.getElementById("giftPanel");
    const giftGrid = document.getElementById("giftGrid");
    const confirmGiftBtn = document.getElementById("confirmGiftBtn");
    const copyChoiceBtn = document.getElementById("copyChoiceBtn");
    const giftStatus = document.getElementById("giftStatus");
    let selectedGift = "";

    function showGiftPanel(){
      if (!giftPanel) return;
      if (giftPanel.style.display !== "block") {
        giftPanel.style.display = "block";
        try { giftPanel.scrollIntoView({behavior:"smooth", block:"start"}); } catch(e){}
      }
    }

    function setSelectedGift(card){
      giftGrid.querySelectorAll(".giftCard").forEach(c=>c.classList.remove("selected"));
      card.classList.add("selected");
      selectedGift = card.getAttribute("data-gift") || "";
    }

    giftGrid?.addEventListener("click", (e)=>{
      const card = e.target.closest(".giftCard");
      if (!card) return;
      setSelectedGift(card);
      try { if (navigator.vibrate) navigator.vibrate(20); } catch(e){}
      emojiBurst();
    });

    function buildChoiceMessage(){
      return `${toName} chose: ${selectedGift} üíñ (From: ${fromName})`;
    }

    async function sendChoice(message){
      if (!FORM_ENDPOINT) return {skipped:true};
      try{
        const res = await fetch(FORM_ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json", "Accept": "application/json" },
          body: JSON.stringify({
            to: toName,
            from: fromName,
            gift: selectedGift,
            message,
            page: location.href,
            time: new Date().toISOString()
          })
        });
        if (!res.ok) throw new Error("bad response");
        return {ok:true};
      }catch(err){
        return {ok:false};
      }
    }

    async function copyText(txt){
      try{
        await navigator.clipboard.writeText(txt);
        showToast("Copied üíå");
        return true;
      }catch(e){
        return false;
      }
    }

    confirmGiftBtn?.addEventListener("click", async ()=>{
      if (!selectedGift){
        giftStatus.style.display = "block";
        giftStatus.textContent = "Pick one first üòÑüëá";
        return;
      }

      const msg = buildChoiceMessage();
      giftStatus.style.display = "block";
      giftStatus.textContent = "Sending‚Ä¶ ‚ú®";
      copyChoiceBtn.style.display = "inline-block";

      burst(); setTimeout(burst, 160);

      const result = await sendChoice(msg);
      if (result.skipped){
        giftStatus.textContent = `Locked in ‚úÖ ${msg}`;
      } else if (result.ok){
        giftStatus.textContent = `Sent ‚úÖ ${msg}`;
        showToast("Sent ‚úÖ");
      } else {
        giftStatus.textContent = `Couldn‚Äôt auto-send üòï Copy and send: ${msg}`;
        showToast("Send failed üòï");
      }
    });

    copyChoiceBtn?.addEventListener("click", async ()=>{
      const txt = giftStatus.textContent.replace("Locked in ‚úÖ ", "").replace("Sent ‚úÖ ", "");
      const ok = await copyText(txt);
      if (!ok) showToast("Copy manually");
    });
  </script>
</body>
</html>
